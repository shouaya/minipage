<user-info>
<div class="weui-panel__bd" onclick="{edit}">
	<a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
		<div class="weui-media-box__hd">
			<img class="weui-media-box__thumb" src="{this.opts.data.pictureUrl}" alt="">
		</div>
		{this.opts.data.displayName}|{this.opts.data.statusMessage}
	</a>
</div>
<user-detail show={this.showDetail}　data={this.opts.data}>
</user-detail>
<script>
this.showDetail=false;
edit(e)
{
	this.showDetail=true;
	this.update();
}
</script>
</user-info>

<reply-info>
{this.opts.data.rule}-{this.opts.data.type}-{this.opts.data.level}-{this.opts.data.business}
<br/>{this.displayMessage}
<div class="weui-panel__ft" onclick="{edit}">
	<a href="javascript:void(0);" class="weui-cell weui-cell_access weui-cell_link">
		<div class="weui-cell__bd">変更</div>
		<span class="weui-cell__ft"></span>
	</a>
</div>
<reply-detail show={this.showDetail} data={this.opts.data}>
</reply-detail>
<script>
this.showDetail=false;
edit(e)
{
	this.showDetail=true;
	this.update();
}
this.on('mount', function(){
    var date = new Date(this.opts.data.postTime);
	if(this.opts.data.message){
		this.displayMessage = this.opts.data.message.substring(0,20);
	}
	this.update();
});
</script>
</reply-info>


<message-info>
{this.postTime}-{this.opts.data.type}
<br/>{this.text}
<hr/>
<script>
this.on('mount', function(){
    var date = new Date(this.opts.data.postTime);
    this.postTime = date.toLocaleString();
	if(this.opts.data.text){
		this.text = this.opts.data.text.substring(0,10);
	}
	this.update();
});
</script>
</message-info>


<reply-detail>
<div class="js_dialog" id="iosDialog2">
	<div class="weui-mask"></div>
	<div class="weui-dialog">
		<div class="weui-dialog__bd">
			<div class="weui-form-preview">
				<div class="weui-form-preview__bd">
					ルール：<input id="rule" class="weui-input" type="text" value="{this.opts.data.rule}" />
				<hr/>
					種類：<input id="type" class="weui-input" type="text" value="{this.opts.data.type}" />
				<hr/>
					レベル：<input id="level" class="weui-input" type="text" value="{this.opts.data.level}" />
				<hr/>
					事件:<input id="business" class="weui-input" type="text" value="{this.opts.data.business}" />
				<hr/>
					中身:<input id="message" class="weui-input" type="text" value="{this.opts.data.message}" />
				</div>
			</div>
		</div>
		<div class="weui-dialog__ft" >
		    <a href="javascript:void(0);" onclick="{edit('update')}" class="weui-dialog__btn weui-dialog__btn_primary">更新</a>
			<a href="javascript:void(0);" onclick="{colse}" class="weui-dialog__btn weui-dialog__btn_primary">閉じる</a>
		</div>
	</div>
</div>
<script>
var self = this;
edit(mode)
{
	return function(e) {
		var postData = {};
		postData.id = this.opts.data.id;
		postData.rule = document.getElementById('rule').value;
		postData.type = document.getElementById('type').value;
		postData.level = document.getElementById('level').value;
		postData.business = document.getElementById('business').value;
		postData.message = document.getElementById('message').value;
		postData.deleted = 0;
		$.ajax({
			url : '/line/reply',
			type : 'POST',
			dataType:"json",
			contentType : 'application/json',
			data : JSON.stringify(postData),
			success : function(data, status) {
				self.parent.showDetail = false;
				self.parent.parent.refresh();
				$('#loadingToast').fadeIn(100);
				setTimeout(function () {
					$('#loadingToast').fadeOut(100);
				}, 2000);
			},
			error : function(xhr, type) {
				alert('error!')
			}
		});
	}
}
colse(e)
{
	this.parent.showDetail = false;
	this.parent.update();
}
</script>
</reply-detail>

<user-detail>

<script>
colse(e)
{
	this.parent.showDetail = false;
	this.parent.update();
}
</script>
</user-detail>
<pagination>
<div class="page">
    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-navbar">
                <div if={ this.parent.page > 1 } class="weui-navbar__item" onclick={last}>
                    <<<<<
                </div>
                <div class="weui-navbar__item" onclick={this.parent.refresh}>
                    Page {this.parent.page}
                </div>
                <div if={ this.parent.page*opts.size < opts.total } class="weui-navbar__item" onclick={next}>
                    >>>>>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
last(e){
	this.parent.page = this.parent.page - 1;
	this.parent.refresh();
}
next(e){
	this.parent.page = this.parent.page + 1;
	this.parent.refresh();
}
</script>
</pagination>
